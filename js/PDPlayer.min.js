let onYouTubeIframeAPIReady;(function(){if(!window.YT)var e={loading:0,loaded:0};if(!window.YTConfig)var t={host:"http://www.youtube.com"};e.loading||(e.loading=1,function(){var i=[];e.ready=function(t){e.loaded?t():i.push(t)},window.onYTReady=function(){e.loaded=1;for(var t=0;t<i.length;t++)try{i[t]()}catch(e){}},e.setConfig=function(e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};var a=document.createElement("script");a.type="text/javascript",a.id="www-widgetapi-script",a.src="https://s.ytimg.com/yts/jsbin/www-widgetapi-vfluwQm_X/www-widgetapi.js",a.async=!0;var s=document.currentScript;if(s){var l=s.nonce||s.getAttribute("nonce");l&&a.setAttribute("nonce",l)}var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)}())})(),HTMLElement.prototype._mousemove=function(e){return this.onmousemove=e,this};class PDPlayer{constructor(e){this.config=e||{},this.event=e.event||{},this.src=e.src,this.videoId=e.videoId,this.volume=e.volume,this.$$mute=e.mute,this.body="div#PDPlayer"._(),"style[name='PDPlayer']".$||document.head._child(["style"._({name:"PDPlayer"},'.full-player{position:absolute;z-index:0;top:-1000vh;left:0;width:0;height:0;overflow:hidden;opacity:0}#PDPlayer{position:absolute;display:block;width:100%;height:100%;border-radius:inherit;font-family:monospace;overflow:hidden}#PDPlayer:hover>div.panel{bottom:.5rem}#PDPlayer>video{z-index:0;position:relative;display:block;width:100%;height:100%;border-radius:inherit;background-color:#000}#PDPlayer>iframe{z-index:0;position:relative;display:block;width:100%;height:100%;border-radius:inherit;background-color:#000}#PDPlayer>div.mask{z-index:1;position:absolute;display:block;top:0;left:0;bottom:0;right:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);backdrop-filter:blur(1rem);-webkit-backdrop-filter:blur(1rem)}#PDPlayer>div.mask.hide{opacity:0;transition:.3s}#PDPlayer>div.mask>img{z-index:1;object-fit:contain;position:absolute;display:block;top:0;left:0;bottom:0;right:0;width:100%;height:100%;background-color:rgba(0,0,0,0)}#PDPlayer>div.panel{z-index:2;position:absolute;display:flex;justify-content:center;align-items:center;left:.5rem;bottom:.5rem;right:.5rem;gap:1rem;padding:0 1rem;width:calc(100% - 1rem);height:2.5rem;background-color:rgba(80,80,80,.8);backdrop-filter:blur(1rem);-webkit-backdrop-filter:blur(1rem);border-radius:1.25rem;box-sizing:border-box;transition:.3s}#PDPlayer>div.panel.hide{bottom:-2.5rem}#PDPlayer>div.panel>p{font-size:.75rem;color:#fff;letter-spacing:2px}#PDPlayer>div.panel>i{width:1.5rem;text-align:center;font-size:1.125rem;color:#fff;transition:.2s}#PDPlayer>div.panel>i:hover{font-size:1.25rem}#PDPlayer>div.panel>a,#PDPlayer>div.panel>button{position:relative;display:flex;justify-content:center;align-items:center;padding:0;width:1.5rem;font-family:monospace;font-size:.75rem;background-color:rgba(0,0,0,0);color:#fff;border:none;cursor:pointer}#PDPlayer>div.panel>a.show>input,#PDPlayer>div.panel>button.show>input{display:flex}#PDPlayer>div.panel>a>i,#PDPlayer>div.panel>button>i{width:1.5rem;text-align:center;font-size:1.125rem;color:#fff;transition:.2s}#PDPlayer>div.panel>a>i:hover,#PDPlayer>div.panel>button>i:hover{font-size:1.25rem}#PDPlayer>div.panel>a>input,#PDPlayer>div.panel>button>input{position:absolute;display:none;right:-3.375rem;bottom:5.5rem;-webkit-appearance:none;appearance:none;outline:none;transform:rotate(-90deg);background-color:rgba(0,0,0,0);box-sizing:border-box}#PDPlayer>div.panel>a>input::before,#PDPlayer>div.panel>button>input::before{content:"";position:absolute;top:50%;transform:translateY(-50%);width:100%;height:8px;background-color:rgba(255,255,255,.5);border-radius:4px}#PDPlayer>div.panel>a>input::-webkit-slider-thumb,#PDPlayer>div.panel>button>input::-webkit-slider-thumb{position:relative;-webkit-appearance:none;appearance:none;width:16px;height:16px;background-color:#fff;border-radius:8px;cursor:pointer}#PDPlayer>div.panel>a>input::-moz-range-thumb,#PDPlayer>div.panel>button>input::-moz-range-thumb{position:relative;-webkit-appearance:none;appearance:none;width:16px;height:16px;background-color:#fff;border-radius:8px;cursor:pointer}#PDPlayer>div.panel>input{flex-grow:1;flex-shrink:1;position:relative;height:1rem;background-color:rgba(0,0,0,0);outline:none;-webkit-appearance:none;appearance:none}#PDPlayer>div.panel>input::before{content:"";position:absolute;top:50%;transform:translateY(-50%);width:100%;height:6px;background-color:rgba(255,255,255,.5);border-radius:4px}#PDPlayer>div.panel>input::-webkit-slider-thumb{position:relative;-webkit-appearance:none;appearance:none;width:25px;height:16px;background-image:linear-gradient(#FFF 50px, transparent 0),linear-gradient(to bottom, #FFF 30%, rgba(0, 0, 0, 0.0509803922) 30% 70%, #FFF 70%),linear-gradient(#FFF 50px, transparent 0),linear-gradient(to bottom, #FFF 30%, rgba(0, 0, 0, 0.0509803922) 30% 70%, #FFF 70%),linear-gradient(#FFF 50px, transparent 0),linear-gradient(to bottom, #FFF 30%, rgba(0, 0, 0, 0.0509803922) 30% 70%, #FFF 70%),linear-gradient(#FFF 50px, transparent 0);background-size:6px 16px,3px 16px,2px 16px,3px 16px,2px 16px,3px 16px,6px 16px;background-position:0px center,6px center,9px center,11px center,14px center,16px center,19px center;background-repeat:no-repeat;animation:test 2s infinite;cursor:pointer;border-radius:4px}#PDPlayer>div.panel>input::-moz-range-thumb{position:relative;-webkit-appearance:none;appearance:none;width:25px;height:16px;background-image:linear-gradient(#FFF 50px, transparent 0),linear-gradient(to bottom, #FFF 30%, rgba(0, 0, 0, 0.0509803922) 30% 70%, #FFF 70%),linear-gradient(#FFF 50px, transparent 0),linear-gradient(to bottom, #FFF 30%, rgba(0, 0, 0, 0.0509803922) 30% 70%, #FFF 70%),linear-gradient(#FFF 50px, transparent 0),linear-gradient(to bottom, #FFF 30%, rgba(0, 0, 0, 0.0509803922) 30% 70%, #FFF 70%),linear-gradient(#FFF 50px, transparent 0);background-size:6px 16px,3px 16px,2px 16px,3px 16px,2px 16px,3px 16px,6px 16px;background-position:0px center,6px center,9px center,11px center,14px center,16px center,19px center;background-repeat:no-repeat;animation:test 2s infinite;cursor:pointer;border-radius:4px}')]),this.src?this.initVideo():this.videoId&&this.initYoutube()}setTimeTxt(e){const t=this.body.$sel("p[name='timeshow']");if(null==e||null==t)return;const i=e,a=Math.floor(i>3599?i/3600:0),s=Math.floor(i>3599?i%3600/60:i>59?i/60:0),l=i>3599?i%3600%60:i>59?i%60:i;t.innerText=`${a<10?`0${a}`:a}:${s<10?`0${s}`:s}:${l<10?`0${l}`:l}`}muteIcon(e){return`fa-solid.${e?"fa-volume-xmark":"fa-volume-high"}`}volumeIcon(e){return`fa-solid.${0===e?"fa-volume-xmark":e>50?"fa-volume-high":e<25?"fa-volume-off":"fa-volume-low"}`}getPause(){return this.$$v?this.player.paused:!!this.$$yt&&1!==this.ytState}setPlay(e){this.$$v?(e?this.fullPlayer:this.player).play():this.$$yt&&(e?this.fullPlayer:this.ytplayer).playVideo()}setPause(e){this.$$v?(e?this.fullPlayer:this.player).pause():this.$$yt&&(e?this.fullPlayer:this.ytplayer).pauseVideo()}getDuration(e){return Math.ceil(this.$$v?(e?this.fullPlayer:this.player).duration:this.$$yt?(e?this.fullPlayer:this.ytplayer).getDuration():0)}getCurrentTime(e){return Math.ceil(this.$$v?(e?this.fullPlayer:this.player).currentTime:this.$$yt?(e?this.fullPlayer:this.ytplayer).getCurrentTime():0)}setSeekTo(e,t){this.$$v?((t?this.fullPlayer:this.player).currentTime=e,this.setPause()):this.$$yt&&((t?this.fullPlayer:this.ytplayer).seekTo(e),this.setPause())}getMute(e){return this.$$v?(e?this.fullPlayer:this.player).muted:!!this.$$yt&&(e?this.fullPlayer:this.ytplayer).isMuted()}setMute(e,t){this.$$v?(t?this.fullPlayer:this.player).muted=e:this.$$yt&&(e?(t?this.fullPlayer:this.ytplayer).mute():(t?this.fullPlayer:this.ytplayer).unMute())}getVolume(e){return this.$$v?100*(e?this.fullPlayer:this.player).volume:this.$$yt?(e?this.fullPlayer:this.ytplayer).getVolume():0}setVolume(e,t){this.$$v?(t?this.fullPlayer:this.player).volume=e/100:this.$$yt&&(t?this.fullPlayer:this.ytplayer).setVolume(e)}getRate(e){return parseFloat(this.$$v?(e?this.fullPlayer:this.player).playbackRate:this.$$yt?(e?this.fullPlayer:this.ytplayer).getPlaybackRate():0)}setRate(e,t){this.$$v?(t?this.fullPlayer:this.player).playbackRate=e:this.$$yt&&(t?this.fullPlayer:this.ytplayer).setPlaybackRate(e)}hidePanel(e){this.hoverTimer=setTimeout(()=>{this.getPause()||this.panel._class("hide")},1e3*e)}initPanel(){this.panel="div.panel"._()._mousemove(()=>{clearTimeout(this.hoverTimer),this.panel.class_("hide"),this.hidePanel(2)})._mouseleave(()=>{this.hidePanel(2)}),(this.config.panel||[]).forEach(e=>{"play"===e?this.panel._child("i.fa-solid.fa-play"._({name:"playbtn"})):"timebar"===e?this.panel._child(["input@range"._({name:"timebar",min:0,value:0})]):"time"===e?this.panel._child(["p"._({name:"timeshow"},"00:00:00")]):"mute"===e?this.panel._child(["i.fa-solid.fa-volume-high"._({name:"mutebtn"})]):"volume"===e?this.panel._child(["button"._(["input"._({name:"volume",type:"range",min:0,max:100,value:0})._input(e=>{const t=parseInt(e.target.value);this.setVolume(t),e.target.$next(0).__class(this.volumeIcon(t))}),"i.fa-solid.fa-volume-high"._({name:"volumebtn"})._click(function(e){this.$parent(0).$$class("show")?this.$parent(0).class_("show"):this.$parent(0)._class("show")})])]):"rate"===e?this.panel._child(["button"._({name:"ratebtn"},"1")]):"full"===e&&this.panel._child(["button"._(["i.fa-solid.fa-expand"._({name:"full"})])])}),this.videoId&&this.panel._child(["a"._(["i.fa-brands.fa-youtube"._()])._open(`https://www.youtube.com/watch?v=${this.videoId}`)])}ready(){null!=this.event.ready&&this.event.ready(),this.$$v=this.src&&this.player,this.$$yt=this.videoId&&this.ytplayer;const e=this.body.$sel("i[name='playbtn']"),t=this.body.$sel("input[name='timebar']"),i=this.body.$sel("i[name='mutebtn']"),a=this.body.$sel("input[name='volume']"),s=this.body.$sel("i[name='volumebtn']"),l=this.body.$sel("button[name='ratebtn']"),n=this.body.$sel("i[name='full']"),r=null!=this.$$mute?this.$$mute:this.getMute(),o=null!=this.volume?this.volume:this.getVolume(),h=this.getRate();this.sec=0,null!=this.$$mute&&this.setMute(this.$$mute),null!=this.volume&&this.setVolume(this.volume),null!=e&&e._click(()=>{this.getPause()?this.setPlay():this.setPause()}),null!=t&&t._attr({max:this.getDuration()})._input(e=>{this.setPlay();const t=parseInt(e.target.value);this.setTimeTxt(t),this.setSeekTo(t),setTimeout(()=>{this.setPlay()},500)}),null!=i&&i.__class(this.muteIcon(r))._click(e=>{const t=this.getMute();this.setMute(!t),e.target.__class(this.muteIcon(!t))}),null!=a&&(a.value=o),null!=s&&s.__class(this.volumeIcon(o)),null!=l&&l.__(h)._click(e=>{const t=[1,1.25,1.5,2,.5],i=this.getRate();let a=t.indexOf(i);.5===i?a=0:a+=1,this.setRate(t[a]),e.target.innerText=t[a]}),null!=n&&n._click(()=>{const e=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen,t=this.body.requestFullscreen||this.body.msRequestFullscreen||this.body.mozRequestFullScreen||this.body.webkitRequestFullscreen,i=document.exitFullscreen||document.msExitFullscree||document.mozCancelFullScreen||document.webkitExitFullscreen;e?$$mobile?this.mobilePause():i&&i.call(document):$$mobile?this.mobilePlay():t&&t.call(this.body)}),this.$$yt&&this.setCover(this.ary.shift())}playing(){null!=this.event.playing&&this.event.playing();const e=this.body.$sel("i[name='playbtn']"),t=this.body.$sel("input[name='timebar']");null!=e&&e.__class("fa-solid fa-pause"),this.$$v||this.$$yt&&(this.start?(this.start=!1,setTimeout(()=>{this.mask.$sel("img")._style({opacity:0}),this.mask._class("hide")},3500)):setTimeout(()=>{this.mask._class("hide")},500));const i=this.getDuration();this.videoTimer=setInterval(()=>{if(null==t)return clearInterval(this.videoTimer);const e=this.getCurrentTime();t.value=e,this.panel._attr({sec:this.live?"live":e}),this.setTimeTxt(e),e===i&&clearInterval(this.videoTimer)},100),this.hidePanel(4)}pause(){null!=this.event.pause&&this.event.pause();const e=this.body.$sel("i[name='playbtn']");null!=e&&e.__class("fa-solid fa-play"),clearInterval(this.videoTimer),this.$$v||this.$$yt&&this.mask.class_("hide"),this.panel.class_("hide")}end(){null!=this.event.end&&this.event.end(),clearInterval(this.videoTimer);const e=this.body.$sel("input[name='timebar']"),t=this.body.$sel("i[name='playbtn']");null!=t&&(e.value=0),null!=t&&t.__class("fa-solid fa-play"),this.panel.class_("hide"),this.setTimeTxt(0),this.$$v?this.player.currentTime=0:this.$$yt&&(this.mask.$sel("img")._style({opacity:1}),this.ytplayer.pauseVideo(),this.ytplayer.seekTo(0),setTimeout(()=>{this.mask.class_("hide"),this.start=!0},50))}fullplaying(){const e=this.getCurrentTime(),t=this.getVolume(),i=this.getRate();this.setPause(),this.setSeekTo(e,!0),this.setVolume(t,!0),this.setRate(i,!0),this.setPlay(!0)}fullpause(){const e=this.body.$sel("input[name='timebar']"),t=this.getCurrentTime(!0),i=this.getVolume(!0),a=this.getRate(!0);this.setTimeTxt(t),this.setSeekTo(t),this.setVolume(i),this.setRate(a),e.value=t}initVideo(){this.src&&(this.player="video"._(["source"._(this.src)])._video({preload:"auto",playsinline:!0}),this.initPanel(),this.body._child([this.player,this.panel])._mousemove(()=>{clearTimeout(this.hoverTimer),this.panel.class_("hide"),this.hidePanel(2)})._mouseleave(()=>{this.hidePanel(2)}),this.player.onloadedmetadata=(()=>this.ready()),this.player.onplaying=(()=>this.playing()),this.player.onpause=(()=>this.pause()),this.player.onended=(()=>this.end()),$$mobile&&(this.fullPlayer="video.full-player"._(["source"._(this.src)])._video({preload:"auto",playsinline:!1}),this.fullPlayer.onplaying=(()=>this.fullplaying()),this.fullPlayer.onpause=(()=>this.fullpause()),this.body._child([this.fullPlayer])))}async setVideoId(e){const t=e=>{if(this.videoId)return this.videoId,e(e);if(this.videoId=prompt("Youtube 影片ID / 網址"),/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(this.videoId)){let t=videoId.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);this.videoId=t&&11==t[7].length?t[7]:null,this.videoId?(history.pushState(null,null,location.href.split("?")[0]+`?videoId=${this.videoId}`),e()):fitVideoId(e)}else e(e)};if(!e)return new Promise((e,i)=>t(e));t(e)}setCover(e){null!=e&&`https://i.ytimg.com/vi/${this.videoId}/${e}.jpg`.$$200().then(e=>{this.mask._child(["img"._(e.target.currentSrc)])}).catch(()=>{this.setCover(this.ary.shift())})}mobilePlay(){this.getPause()||(this.setPause(),this.setPlay(!0))}initYoutube(){if(!this.videoId)return;const e=$key(24),t=$key(24);this.start=!0,this.ary=["maxresdefault","sddefault","hqdefault","mqdefault"],this.player=`div#${e}`._(),this.mask="div.mask"._({sec:this.live?"live":0}),this.initPanel(),this.body._child([this.player,$$mobile?`div#${t}.full-player`._():null,this.mask,this.panel])._mousemove(()=>{clearTimeout(this.hoverTimer),this.panel.class_("hide"),this.hidePanel(2)})._mouseleave(()=>{this.hidePanel(2)}),onYouTubeIframeAPIReady=(async()=>{await this.setVideoId(),this.ytplayer=new YT.Player(e,{videoId:this.videoId,width:"100%",height:"100%",playerVars:{autoplay:0,controls:0,showinfo:0,modestbranding:1,start:0,loop:0,fs:0,rel:0,cc_load_policty:1,iv_load_policy:3,autohide:1,playsinline:1},events:{onReady:e=>{this.ready()},onStateChange:e=>{switch(this.ytState=e.data,e.data){case 0:this.end();break;case 1:this.playing();break;case 2:this.pause()}}}}),$$mobile&&(this.fullPlayer=new YT.Player(t,{videoId:this.videoId,width:"0",height:"0",playerVars:{autoplay:0,controls:0,showinfo:0,modestbranding:1,start:0,loop:0,fs:0,rel:0,cc_load_policty:1,iv_load_policy:3,autohide:1,playsinline:0},events:{onReady:function(){console.log("fullready")},onStateChange:e=>{switch(console.log(e.data),e.data){case 1:break;case 2:this.fullpause();break;case 3:this.fullplaying()}}}}))}),onYouTubeIframeAPIReady()}}