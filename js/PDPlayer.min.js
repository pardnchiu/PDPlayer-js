let onYouTubeIframeAPIReady;(function(){if(!window.YT)var t={loading:0,loaded:0};if(!window.YTConfig)var e={host:"http://www.youtube.com"};t.loading||(t.loading=1,function(){var i=[];t.ready=function(e){t.loaded?e():i.push(e)},window.onYTReady=function(){t.loaded=1;for(var e=0;e<i.length;e++)try{i[e]()}catch(t){}},t.setConfig=function(t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};var s=document.createElement("script");s.type="text/javascript",s.id="www-widgetapi-script",s.src="https://s.ytimg.com/yts/jsbin/www-widgetapi-vfluwQm_X/www-widgetapi.js",s.async=!0;var l=document.currentScript;if(l){var a=l.nonce||l.getAttribute("nonce");a&&s.setAttribute("nonce",a)}var h=document.getElementsByTagName("script")[0];h.parentNode.insertBefore(s,h)}())})(),HTMLElement.prototype._mousemove=function(t){return this.onmousemove=t,this};class PDPlayer{constructor(t){this.config=t||{},this.src=t.src,this.videoId=t.videoId,this.volume=t.volume,this.$$mute=t.mute,this.body="div#PDPlayer"._(),this.src?this.initVideo():this.videoId&&this.initYoutube()}setTimeTxt(t){const e=this.body.$sel("p[name='timeshow']");if(null==t||null==e)return;const i=t,s=Math.floor(i>3599?i/3600:0),l=Math.floor(i>3599?i%3600/60:i>59?i/60:0),a=i>3599?i%3600%60:i>59?i%60:i;e.innerText=`${s<10?`0${s}`:s}:${l<10?`0${l}`:l}:${a<10?`0${a}`:a}`}muteIcon(t){return`fa-solid.${t?"fa-volume-xmark":"fa-volume-high"}`}volumeIcon(t){return`fa-solid.${0===t?"fa-volume-xmark":t>50?"fa-volume-high":t<25?"fa-volume-off":"fa-volume-low"}`}getPause(){return this.$$v?this.player.paused:!!this.$$yt&&1!==this.ytState}setPlay(t){this.$$v?(t?this.fullPlayer:this.player).play():this.$$yt&&(t?this.fullPlayer:this.ytplayer).playVideo()}setPause(t){this.$$v?(t?this.fullPlayer:this.player).pause():this.$$yt&&(t?this.fullPlayer:this.ytplayer).pauseVideo()}getDuration(t){return Math.ceil(this.$$v?(t?this.fullPlayer:this.player).duration:this.$$yt?(t?this.fullPlayer:this.ytplayer).getDuration():0)}getCurrentTime(t){return Math.ceil(this.$$v?(t?this.fullPlayer:this.player).currentTime:this.$$yt?(t?this.fullPlayer:this.ytplayer).getCurrentTime():0)}setSeekTo(t,e){this.$$v?((e?this.fullPlayer:this.player).currentTime=t,this.setPause()):this.$$yt&&((e?this.fullPlayer:this.ytplayer).seekTo(t),this.setPause())}getMute(t){return this.$$v?(t?this.fullPlayer:this.player).muted:!!this.$$yt&&(t?this.fullPlayer:this.ytplayer).isMuted()}setMute(t,e){this.$$v?(e?this.fullPlayer:this.player).muted=t:this.$$yt&&(t?(e?this.fullPlayer:this.ytplayer).mute():(e?this.fullPlayer:this.ytplayer).unMute())}getVolume(t){return this.$$v?100*(t?this.fullPlayer:this.player).volume:this.$$yt?(t?this.fullPlayer:this.ytplayer).getVolume():0}setVolume(t,e){this.$$v?(e?this.fullPlayer:this.player).volume=t/100:this.$$yt&&(e?this.fullPlayer:this.ytplayer).setVolume(t)}getRate(t){return parseFloat(this.$$v?(t?this.fullPlayer:this.player).playbackRate:this.$$yt?(t?this.fullPlayer:this.ytplayer).getPlaybackRate():0)}setRate(t,e){this.$$v?(e?this.fullPlayer:this.player).playbackRate=t:this.$$yt&&(e?this.fullPlayer:this.ytplayer).setPlaybackRate(t)}hidePanel(t){this.hoverTimer=setTimeout(()=>{this.getPause()||this.panel._class("hide")},1e3*t)}initPanel(){this.panel="div.panel"._()._mousemove(()=>{clearTimeout(this.hoverTimer),this.panel.class_("hide"),this.hidePanel(2)})._mouseleave(()=>{this.hidePanel(2)}),(this.config.panel||[]).forEach(t=>{"play"===t?this.panel._child("i.fa-solid.fa-play"._({name:"playbtn"})):"timebar"===t?this.panel._child(["input@range"._({name:"timebar",min:0,value:0})]):"time"===t?this.panel._child(["p"._({name:"timeshow"},"00:00:00")]):"mute"===t?this.panel._child(["i.fa-solid.fa-volume-high"._({name:"mutebtn"})]):"volume"===t?this.panel._child(["button"._(["input"._({name:"volume",type:"range",min:0,max:100,value:0})._input(t=>{const e=parseInt(t.target.value);this.setVolume(e),t.target.$next(0).__class(this.volumeIcon(e))}),"i.fa-solid.fa-volume-high"._({name:"volumebtn"})._click(function(t){this.$parent(0).$$class("show")?this.$parent(0).class_("show"):this.$parent(0)._class("show")})])]):"rate"===t?this.panel._child(["button"._({name:"ratebtn"},"1")]):"full"===t&&this.panel._child(["button"._(["i.fa-solid.fa-expand"._({name:"full"})])])}),this.videoId&&this.panel._child(["a"._(["i.fa-brands.fa-youtube"._()])._open(`https://www.youtube.com/watch?v=${this.videoId}`)])}ready(){console.log("ready"),this.$$v=this.src&&this.player,this.$$yt=this.videoId&&this.ytplayer;const t=this.body.$sel("i[name='playbtn']"),e=this.body.$sel("input[name='timebar']"),i=this.body.$sel("i[name='mutebtn']"),s=this.body.$sel("input[name='volume']"),l=this.body.$sel("i[name='volumebtn']"),a=this.body.$sel("button[name='ratebtn']"),h=this.body.$sel("i[name='full']"),o=null!=this.$$mute?this.$$mute:this.getMute(),n=null!=this.volume?this.volume:this.getVolume(),u=this.getRate();this.sec=0,null!=this.$$mute&&this.setMute(this.$$mute),null!=this.volume&&this.setVolume(this.volume),null!=t&&t._click(()=>{this.getPause()?this.setPlay():this.setPause()}),null!=e&&e._attr({max:this.getDuration()})._input(t=>{this.setPlay();const e=parseInt(t.target.value);this.setTimeTxt(e),this.setSeekTo(e),setTimeout(()=>{this.setPlay()},500)}),null!=i&&i.__class(this.muteIcon(o))._click(t=>{const e=this.getMute();this.setMute(!e),t.target.__class(this.muteIcon(!e))}),null!=s&&(s.value=n),null!=l&&l.__class(this.volumeIcon(n)),null!=a&&a.__(u)._click(t=>{const e=[1,1.25,1.5,2,.5],i=this.getRate();let s=e.indexOf(i);.5===i?s=0:s+=1,this.setRate(e[s]),t.target.innerText=e[s]}),null!=h&&h._click(()=>{const t=document.fullScreen||document.mozFullScreen||document.webkitIsFullScreen,e=this.body.requestFullscreen||this.body.msRequestFullscreen||this.body.mozRequestFullScreen||this.body.webkitRequestFullscreen,i=document.exitFullscreen||document.msExitFullscree||document.mozCancelFullScreen||document.webkitExitFullscreen;t?$$mobile?this.mobilePause():i&&i.call(document):$$mobile?this.mobilePlay():e&&e.call(this.body)}),this.$$yt&&this.setCover(this.ary.shift())}playing(){console.log("playing");const t=this.body.$sel("i[name='playbtn']"),e=this.body.$sel("input[name='timebar']");null!=t&&t.__class("fa-solid fa-pause"),this.$$v||this.$$yt&&(this.start?(this.start=!1,setTimeout(()=>{this.mask.$child(0)._style({opacity:0}),this.mask._class("hide")},3500)):setTimeout(()=>{this.mask._class("hide")},500));const i=this.getDuration();this.videoTimer=setInterval(()=>{if(null==e)return clearInterval(this.videoTimer);const t=this.getCurrentTime();e.value=t,this.panel._attr({sec:this.live?"live":t}),this.setTimeTxt(t),t===i&&clearInterval(this.videoTimer)},100),this.hidePanel(4)}pause(){console.log("pause");const t=this.body.$sel("i[name='playbtn']");null!=t&&t.__class("fa-solid fa-play"),clearInterval(this.videoTimer),this.$$v||this.$$yt&&this.mask.class_("hide"),this.panel.class_("hide")}end(){console.log("end");const t=this.body.$sel("input[name='timebar']");t.value=0,this.pause(),this.setTimeTxt(0),this.$$v?this.player.currentTime=0:this.$$yt&&(this.ytplayer.seekTo(0),this.ytplayer.pauseVideo(),this.mask.$child(0)._style({opacity:1}),this.start=!0)}fullplaying(){const t=this.getCurrentTime(),e=this.getVolume(),i=this.getRate();this.setPause(),this.setSeekTo(t,!0),this.setVolume(e,!0),this.setRate(i,!0),this.setPlay(!0)}fullpause(){const t=this.body.$sel("input[name='timebar']"),e=this.getCurrentTime(!0),i=this.getVolume(!0),s=this.getRate(!0);this.setTimeTxt(e),this.setSeekTo(e),this.setVolume(i),this.setRate(s),t.value=e}initVideo(){this.src&&(this.player="video"._(["source"._(this.src)])._video({preload:"auto",playsinline:!0}),this.initPanel(),this.body._child([this.player,this.panel])._mousemove(()=>{clearTimeout(this.hoverTimer),this.panel.class_("hide"),this.hidePanel(2)})._mouseleave(()=>{this.hidePanel(2)}),this.player.onloadedmetadata=(()=>this.ready()),this.player.onplaying=(()=>this.playing()),this.player.onpause=(()=>this.pause()),this.player.onended=(()=>this.end()),$$mobile&&(this.fullPlayer="video.full-player"._(["source"._(this.src)])._video({preload:"auto",playsinline:!1}),this.fullPlayer.onplaying=(()=>this.fullplaying()),this.fullPlayer.onpause=(()=>this.fullpause()),this.body._child([this.fullPlayer])))}async setVideoId(t){const e=t=>{if(this.videoId)return this.videoId,t(t);if(this.videoId=prompt("Youtube 影片ID / 網址"),/https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/.test(this.videoId)){let e=videoId.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/);this.videoId=e&&11==e[7].length?e[7]:null,this.videoId?(history.pushState(null,null,location.href.split("?")[0]+`?videoId=${this.videoId}`),t()):fitVideoId(t)}else t(t)};if(!t)return new Promise((t,i)=>e(t));e(t)}setCover(t){null!=t&&`https://i.ytimg.com/vi/${this.videoId}/${t}.jpg`.$$200().then(t=>{this.mask._child(["img"._(t.target.currentSrc)])}).catch(()=>{this.setCover(this.ary.shift())})}mobilePlay(){this.getPause()||(this.setPause(),this.setPlay(!0))}initYoutube(){if(!this.videoId)return;const t=$key(24),e=$key(24);this.start=!0,this.ary=["maxresdefault","sddefault","hqdefault","mqdefault"],this.player=`div#${t}`._(),this.mask="div.mask"._({sec:this.live?"live":0}),this.initPanel(),this.body._child([this.player,$$mobile?`div#${e}.full-player`._():null,this.mask,this.panel])._mousemove(()=>{clearTimeout(this.hoverTimer),this.panel.class_("hide"),this.hidePanel(2)})._mouseleave(()=>{this.hidePanel(2)}),onYouTubeIframeAPIReady=(async()=>{await this.setVideoId(),this.ytplayer=new YT.Player(t,{videoId:this.videoId,width:"100%",height:"100%",playerVars:{autoplay:0,controls:0,showinfo:0,modestbranding:1,start:0,loop:0,fs:0,rel:0,cc_load_policty:1,iv_load_policy:3,autohide:1,playsinline:1},events:{onReady:t=>{this.ready()},onStateChange:t=>{switch(this.ytState=t.data,t.data){case 0:this.end();break;case 1:this.playing();break;case 2:this.pause()}}}}),$$mobile&&(this.fullPlayer=new YT.Player(e,{videoId:this.videoId,width:"0",height:"0",playerVars:{autoplay:0,controls:0,showinfo:0,modestbranding:1,start:0,loop:0,fs:0,rel:0,cc_load_policty:1,iv_load_policy:3,autohide:1,playsinline:0},events:{onReady:function(){console.log("fullready")},onStateChange:t=>{switch(console.log(t.data),t.data){case 1:break;case 2:this.fullpause();break;case 3:this.fullplaying()}}}}))}),onYouTubeIframeAPIReady()}}